<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ESP32-CAM Rover</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header>
    <div class="logo">
      <img src="/logo.svg" alt="Logo" width="32" height="32">
    </div>
    <h1>ESP32-CAM Rover</h1>
    <div class="status" id="connection-status">
      <span class="dot"></span>
      <span class="text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
    </div>
  </header>

  <main>
    <!-- –í–∏–¥–µ–æ –ø–∞–Ω–µ–ª—å —Å –¥–∂–æ–π—Å—Ç–∏–∫–∞–º–∏ –ø–æ–≤–µ—Ä—Ö -->
    <div class="video-panel">
      <div class="video-container">
        <!-- MJPEG —Å—Ç—Ä–∏–º (ESP32, IP –∫–∞–º–µ—Ä—ã) -->
        <img id="video-feed" alt="Video Feed" crossorigin="anonymous">
        <!-- –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ–±–∫–∞ (getUserMedia) -->
        <video id="video-local" autoplay playsinline muted></video>
        
        <div class="video-overlay" id="video-overlay">
          <div class="loader"></div>
          <span>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∏–º–∞...</span>
        </div>
        
        <!-- üé¨ Compositor Overlay (–µ–¥–∏–Ω—ã–π canvas –¥–ª—è –≤—Å–µ—Ö —Å–ª–æ—ë–≤) -->
        <canvas id="compositor-overlay" class="compositor-overlay"></canvas>
        
        <!-- üìä OSD Overlay (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ, –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞) -->
        <div class="osd-overlay" id="osd-overlay">
          <!-- WiFi / RSSI -->
          <div class="osd-widget">
            <span class="osd-icon">üì∂</span><span id="osd-rssi" class="osd-val">‚Äî</span><span class="osd-unit">dBm</span>
          </div>
          <!-- IP -->
          <div class="osd-widget">
            <span class="osd-icon">üì°</span><span id="osd-ip" class="osd-val">‚Äî</span>
          </div>
          <!-- Uptime -->
          <div class="osd-widget">
            <span class="osd-icon">‚è±</span><span id="osd-uptime" class="osd-val">‚Äî</span>
          </div>
          <!-- Heap -->
          <div class="osd-widget">
            <span class="osd-icon">üß†</span><span id="osd-heap" class="osd-val">‚Äî</span>
          </div>
          <!-- PSRAM -->
          <div class="osd-widget">
            <span class="osd-icon">üíæ</span><span id="osd-psram" class="osd-val">‚Äî</span>
          </div>
          <!-- CPU -->
          <div class="osd-widget">
            <span class="osd-icon">‚ö°</span><span id="osd-cpu" class="osd-val">‚Äî</span><span class="osd-unit">MHz</span>
          </div>
          <!-- Stream clients -->
          <div class="osd-widget">
            <span class="osd-icon">üë•</span><span id="osd-clients" class="osd-val">‚Äî</span>
          </div>
          <!-- LED -->
          <div class="osd-widget">
            <span class="osd-icon">üí°</span><span id="osd-led" class="osd-val">‚Äî</span>
          </div>
          <!-- Motion (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
          <div class="osd-widget osd-motion" id="osd-motion-widget" style="display: none;">
            <span class="osd-icon">üî¥</span><span id="osd-motion-percent" class="osd-val">0%</span>
            <span class="osd-unit">|</span><span id="osd-motion-regions" class="osd-val">0</span><span class="osd-unit">reg</span>
          </div>
          <!-- Motors (–∫–æ–º–ø–∞–∫—Ç–Ω–æ) -->
          <div class="osd-widget osd-motors">
            <span class="osd-motor">FL:<span id="osd-fl">0</span></span>
            <span class="osd-motor">FR:<span id="osd-fr">0</span></span>
            <span class="osd-motor">RL:<span id="osd-rl">0</span></span>
            <span class="osd-motor">RR:<span id="osd-rr">0</span></span>
          </div>
        </div>
        
        <!-- üéÆ –î–∂–æ–π—Å—Ç–∏–∫–∏ –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ (DJI-style) -->
        <div class="joysticks-overlay" id="joysticks-overlay">
          <!-- –õ–µ–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ ‚Äî –ì–ê–ó (—Ç–æ–ª—å–∫–æ Y) -->
          <div class="joystick-wrapper left">
            <div class="joystick-area" id="joystick-left">
              <div class="joystick-base">
                <div class="joystick-stick" id="stick-left"></div>
              </div>
              <div class="joystick-rail vertical"></div>
            </div>
            <div class="joystick-label">
              <span class="axis-icon">‚¨Ü‚¨á</span>
              <span class="axis-name">–ì–ê–ó</span>
              <span class="axis-value" id="joy-y">0</span>
              <span class="axis-expo" id="expo-y">‚Üí0</span>
            </div>
          </div>

          <!-- –ü—Ä–∞–≤—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ ‚Äî –†–£–õ–¨ (—Ç–æ–ª—å–∫–æ X) -->
          <div class="joystick-wrapper right">
            <div class="joystick-area" id="joystick-right">
              <div class="joystick-base">
                <div class="joystick-stick" id="stick-right"></div>
              </div>
              <div class="joystick-rail horizontal"></div>
            </div>
            <div class="joystick-label">
              <span class="axis-icon">‚¨Ö‚û°</span>
              <span class="axis-name">–†–£–õ–¨</span>
              <span class="axis-value" id="joy-x">0</span>
              <span class="axis-expo" id="expo-x">‚Üí0</span>
            </div>
          </div>

          <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è -->
          <div class="control-indicator">
            <span id="joy-active">‚ö™</span>
            <span id="control-status" class="control-status"></span>
          </div>
        </div>
      </div>

      <div class="controls">
        <button id="stream-toggle" class="btn primary">
          <span class="icon">‚ñ∂</span> –°—Ç—Ä–∏–º
        </button>
        <button id="webcam-btn" class="btn secondary" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–±–∫—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞">
          <span class="icon">üé•</span> –í–µ–±–∫–∞
        </button>
        <button id="photo-btn" class="btn secondary">
          <span class="icon">üì∑</span> –§–æ—Ç–æ
        </button>
        <button id="led-btn" class="btn led">
          <span class="icon">üí°</span> LED
        </button>
        <button id="base-layer-btn" class="btn base-layer active" title="–ë–∞–∑–æ–≤—ã–π —Å–ª–æ–π (–≤–∏–¥–µ–æ)">
          <span class="icon">üñºÔ∏è</span> Base
        </button>
        <button id="cv-btn" class="btn cv" title="Scene Analysis (OpenCV.js)">
          <span class="icon">üëÅÔ∏è</span> Scene
        </button>
        <button id="motion-btn" class="btn motion" title="Motion Detection">
          <span class="icon">üî¥</span> Motion
        </button>
      </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="info-panel">
      <div class="info-item">
        <span class="label">–°—Ç—Ä–∏–º URL</span>
        <code id="stream-url">‚Äî</code>
      </div>
      <div class="info-item">
        <span class="label">–°—Ç–∞—Ç—É—Å</span>
        <span id="stream-status">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="settings-panel">
      <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      
      <!-- –†–µ–∂–∏–º –¥–∂–æ–π—Å—Ç–∏–∫–æ–≤ -->
      <div class="setting-row">
        <span class="setting-label">–î–∂–æ–π—Å—Ç–∏–∫–∏</span>
        <div class="toggle-switch">
          <button class="toggle-btn active" data-mode="dual">–†–∞–∑–¥–µ–ª—å–Ω—ã–µ</button>
          <button class="toggle-btn" data-mode="single">–û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π</button>
        </div>
      </div>

      <!-- –†–∞–∑–º–µ—Ä —Å—Ç–∏–∫–æ–≤ (¬±75%) -->
      <div class="setting-row">
        <span class="setting-label">–†–∞–∑–º–µ—Ä —Å—Ç–∏–∫–æ–≤</span>
        <div class="param-slider-ctrl">
          <input type="range" id="joystick-scale-slider" class="param-slider"
                 min="25" max="175" value="100" step="5">
          <span class="param-slider-value" id="joystick-scale-value">100%</span>
        </div>
      </div>

      <!-- Expo –ø–∞–Ω–µ–ª—å: —Å–ª–∞–π–¥–µ—Ä Y | –≥—Ä–∞—Ñ–∏–∫ | —Å–ª–∞–π–¥–µ—Ä X -->
      <div class="expo-panel">
        <!-- –õ–µ–≤—ã–π: Y (–≥–∞–∑) -->
        <div class="expo-axis expo-axis-y">
          <span class="expo-axis-title">–ì–ê–ó</span>
          <input type="range" id="expo-slider-y" class="expo-vslider expo-y"
                 min="-100" max="100" value="0" step="5">
          <span class="expo-axis-value" id="expo-value-y">0</span>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä: –≥—Ä–∞—Ñ–∏–∫ -->
        <div class="expo-graph-wrap">
          <canvas id="expo-graph" width="150" height="150"></canvas>
          <div class="expo-labels">
            <span class="label-expo" id="expo-label-x" style="color:#ff9800">X: ‚Äî</span>
            <span class="label-expo" id="expo-label-y" style="color:#4caf50">Y: ‚Äî</span>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤—ã–π: X (—Ä—É–ª—å) -->
        <div class="expo-axis expo-axis-x">
          <span class="expo-axis-title">–†–£–õ–¨</span>
          <input type="range" id="expo-slider-x" class="expo-vslider expo-x"
                 min="-100" max="100" value="0" step="5">
          <span class="expo-axis-value" id="expo-value-x">0</span>
        </div>
      </div>

      <!-- üîß –î–∏–∞–ø–∞–∑–æ–Ω PWM: –ì–ê–ó —Å–ª–µ–≤–∞ | –ø–æ–¥–ø–∏—Å—å | –†–£–õ–¨ —Å–ø—Ä–∞–≤–∞ -->
      <div class="output-range-panel">
        <div class="output-axis output-axis-y">
          <span class="output-axis-title">–ì–ê–ó (Y)</span>
          <div class="output-slider-row">
            <span class="output-slider-label">–º–∏–Ω</span>
            <input type="range" id="output-min-y-slider" class="param-slider"
                   min="0" max="150" value="0" step="5">
            <span class="param-slider-value" id="output-min-y-value">0</span>
          </div>
          <div class="output-slider-row">
            <span class="output-slider-label">–º–∞–∫—Å</span>
            <input type="range" id="output-max-y-slider" class="param-slider"
                   min="100" max="255" value="255" step="5">
            <span class="param-slider-value" id="output-max-y-value">255</span>
          </div>
        </div>
        <div class="output-range-center">
          <span class="output-range-title">PWM</span>
          <span class="output-range-hint">–º–∏–Ω ‚Üî –º–∞–∫—Å</span>
        </div>
        <div class="output-axis output-axis-x">
          <span class="output-axis-title">–†–£–õ–¨ (X)</span>
          <div class="output-slider-row">
            <span class="output-slider-label">–º–∏–Ω</span>
            <input type="range" id="output-min-x-slider" class="param-slider"
                   min="0" max="150" value="0" step="5">
            <span class="param-slider-value" id="output-min-x-value">0</span>
          </div>
          <div class="output-slider-row">
            <span class="output-slider-label">–º–∞–∫—Å</span>
            <input type="range" id="output-max-x-slider" class="param-slider"
                   min="100" max="255" value="255" step="5">
            <span class="param-slider-value" id="output-max-x-value">255</span>
          </div>
        </div>
      </div>

      <!-- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="setting-row setting-save-row">
        <button type="button" id="settings-save-btn" class="btn btn-save-settings">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
      </div>

      <!-- üìä OSD –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="setting-row">
        <span class="setting-label">üìä OSD</span>
        <div class="toggle-switch">
          <button class="toggle-btn active" id="osd-toggle">ON</button>
        </div>
      </div>
      <div class="setting-row" id="osd-interval-row">
        <span class="setting-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª OSD</span>
        <div class="osd-interval-ctrl">
          <input type="range" id="osd-interval-slider" class="osd-slider"
                 min="1" max="10" value="5" step="1">
          <span class="osd-interval-value" id="osd-interval-value">5 —Å–µ–∫</span>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           üëÅÔ∏è SCENE (CVProcessor) ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ + –ø—Ä–µ–≤—å—é —Å–ª–æ—ë–≤
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="processor-block" id="scene-settings-section" style="display: none;">
        <h3 class="processor-block-title">üëÅÔ∏è Scene</h3>

        <!-- –ü—Ä–µ–≤—å—é-–ø–ª–∏—Ç–∫–∏ —Å–ª–æ—ë–≤ (6 —Å–ª–æ—ë–≤ Scene) -->
        <div class="layer-tiles" id="scene-layer-tiles">
          <div class="layer-tile" data-layer-idx="0">
            <canvas class="layer-tile-canvas" id="layer-preview-0" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="0" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Gray</span>
          </div>
          <div class="layer-tile" data-layer-idx="1">
            <canvas class="layer-tile-canvas" id="layer-preview-1" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="1" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Edges</span>
          </div>
          <div class="layer-tile" data-layer-idx="2">
            <canvas class="layer-tile-canvas" id="layer-preview-2" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="2" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Lines</span>
          </div>
          <div class="layer-tile" data-layer-idx="3">
            <canvas class="layer-tile-canvas" id="layer-preview-3" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="3" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Horizon</span>
          </div>
          <div class="layer-tile" data-layer-idx="4">
            <canvas class="layer-tile-canvas" id="layer-preview-4" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="4" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Grid</span>
          </div>
          <div class="layer-tile" data-layer-idx="5">
            <canvas class="layer-tile-canvas" id="layer-preview-5" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="5" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Walls</span>
          </div>
        </div>

        <!-- Scene –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å–ª–∞–π–¥–µ—Ä—ã) -->
        <div class="processor-params">
          <div class="setting-row">
            <span class="setting-label">Canny Low</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-canny-low" class="param-slider" min="10" max="200" value="50" step="5">
              <span class="param-slider-value" id="scene-canny-low-val">50</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Canny High</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-canny-high" class="param-slider" min="30" max="400" value="150" step="10">
              <span class="param-slider-value" id="scene-canny-high-val">150</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Hough –ø–æ—Ä–æ–≥</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-hough-thresh" class="param-slider" min="10" max="200" value="50" step="5">
              <span class="param-slider-value" id="scene-hough-thresh-val">50</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Hough –º–∏–Ω. –¥–ª–∏–Ω–∞</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-hough-minlen" class="param-slider" min="10" max="200" value="50" step="5">
              <span class="param-slider-value" id="scene-hough-minlen-val">50</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">Hough –º–∞–∫—Å. —Ä–∞–∑—Ä—ã–≤</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-hough-maxgap" class="param-slider" min="1" max="50" value="10" step="1">
              <span class="param-slider-value" id="scene-hough-maxgap-val">10</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–ú–∞–∫—Å. —É–≥–æ–ª –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-horizon-angle" class="param-slider" min="10" max="80" value="45" step="5">
              <span class="param-slider-value" id="scene-horizon-angle-val">45</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–î–æ–ø—É—Å–∫ —Å—Ç–µ–Ω</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-wall-tol" class="param-slider" min="5" max="45" value="15" step="1">
              <span class="param-slider-value" id="scene-wall-tol-val">15</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-smooth" class="param-slider" min="1" max="15" value="5" step="1">
              <span class="param-slider-value" id="scene-smooth-val">5</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª (–º—Å)</span>
            <div class="param-slider-ctrl">
              <input type="range" id="scene-interval" class="param-slider" min="50" max="500" value="100" step="10">
              <span class="param-slider-value" id="scene-interval-val">100</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           üî¥ MOTION (MotionDetector) ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ + –ø—Ä–µ–≤—å—é —Å–ª–æ—ë–≤
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="processor-block" id="motion-settings-section" style="display: none;">
        <h3 class="processor-block-title">üî¥ Motion</h3>

        <!-- –ü—Ä–µ–≤—å—é-–ø–ª–∏—Ç–∫–∏ —Å–ª–æ—ë–≤ (3 —Å–ª–æ—è Motion) -->
        <div class="layer-tiles" id="motion-layer-tiles">
          <div class="layer-tile" data-layer-idx="6">
            <canvas class="layer-tile-canvas" id="layer-preview-6" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="6" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Mask</span>
          </div>
          <div class="layer-tile" data-layer-idx="7">
            <canvas class="layer-tile-canvas" id="layer-preview-7" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="7" title="Solo">üëÅ</button>
            <span class="layer-tile-label">Contours</span>
          </div>
          <div class="layer-tile" data-layer-idx="8">
            <canvas class="layer-tile-canvas" id="layer-preview-8" width="120" height="90"></canvas>
            <button class="layer-eye-btn" data-layer-idx="8" title="Solo">üëÅ</button>
            <span class="layer-tile-label">BB</span>
          </div>
        </div>

        <!-- –î–µ—Å–∞—Ç—É—Ä–∞—Ü–∏—è + OSD -->
        <div class="processor-params">
          <div class="setting-row">
            <span class="setting-label">üå´Ô∏è –î–µ—Å–∞—Ç—É—Ä–∞—Ü–∏—è</span>
            <div class="toggle-switch">
              <button class="toggle-btn" id="motion-desaturate-toggle">OFF</button>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">üìä OSD Motion</span>
            <div class="toggle-switch">
              <button class="toggle-btn active" id="motion-osd-toggle">ON</button>
            </div>
          </div>
        </div>

        <!-- Motion –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å–ª–∞–π–¥–µ—Ä—ã) -->
        <div class="processor-params">
          <div class="setting-row">
            <span class="setting-label">–ü–æ—Ä–æ–≥</span>
            <div class="param-slider-ctrl">
              <input type="range" id="motion-threshold-slider" class="param-slider"
                     min="5" max="100" value="25" step="1">
              <span class="param-slider-value" id="motion-threshold-value">25</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–ú–∏–Ω. –æ–±–ª–∞—Å—Ç—å</span>
            <div class="param-slider-ctrl">
              <input type="range" id="motion-minarea-slider" class="param-slider"
                     min="50" max="5000" value="500" step="50">
              <span class="param-slider-value" id="motion-minarea-value">500</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ</span>
            <div class="param-slider-ctrl">
              <input type="range" id="motion-blur-slider" class="param-slider"
                     min="3" max="15" value="5" step="2">
              <span class="param-slider-value" id="motion-blur-value">5</span>
            </div>
          </div>
          <div class="setting-row">
            <span class="setting-label">–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ</span>
            <div class="param-slider-ctrl">
              <input type="range" id="motion-dilate-slider" class="param-slider"
                     min="0" max="5" value="2" step="1">
              <span class="param-slider-value" id="motion-dilate-value">2</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–∞–º–∏ -->
    <div class="drive-panel">
      <h2>üöó –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–∞–º–∏</h2>
      
      <div class="motors-grid">
        <!-- Front Left -->
        <div class="motor-control" data-motor="fl">
          <span class="motor-label">FL</span>
          <div class="motor-buttons">
            <button class="btn-motor inc" data-action="increment">+</button>
            <button class="btn-motor dec" data-action="decrement">‚àí</button>
          </div>
          <div class="motor-bar">
            <div class="motor-bar-fill" id="bar-fl"></div>
          </div>
          <span class="motor-value" id="val-fl">0</span>
        </div>

        <!-- Front Right -->
        <div class="motor-control" data-motor="fr">
          <span class="motor-label">FR</span>
          <div class="motor-buttons">
            <button class="btn-motor inc" data-action="increment">+</button>
            <button class="btn-motor dec" data-action="decrement">‚àí</button>
          </div>
          <div class="motor-bar">
            <div class="motor-bar-fill" id="bar-fr"></div>
          </div>
          <span class="motor-value" id="val-fr">0</span>
        </div>

        <!-- Rear Left -->
        <div class="motor-control" data-motor="rl">
          <span class="motor-label">RL</span>
          <div class="motor-buttons">
            <button class="btn-motor inc" data-action="increment">+</button>
            <button class="btn-motor dec" data-action="decrement">‚àí</button>
          </div>
          <div class="motor-bar">
            <div class="motor-bar-fill" id="bar-rl"></div>
          </div>
          <span class="motor-value" id="val-rl">0</span>
        </div>

        <!-- Rear Right -->
        <div class="motor-control" data-motor="rr">
          <span class="motor-label">RR</span>
          <div class="motor-buttons">
            <button class="btn-motor inc" data-action="increment">+</button>
            <button class="btn-motor dec" data-action="decrement">‚àí</button>
          </div>
          <div class="motor-bar">
            <div class="motor-bar-fill" id="bar-rr"></div>
          </div>
          <span class="motor-value" id="val-rr">0</span>
        </div>
      </div>

      <button id="stop-all" class="btn stop-btn">üõë STOP ALL</button>
    </div>

  </main>

  <footer>
    <p>ESP32-CAM Rover ¬© 2026</p>
  </footer>

  <script src="/config.js"></script>
  <script src="/control.js"></script>
  <script src="/cv-processor.js"></script>
  <script src="/motion-detector.js"></script>
  <script src="/compositor.js"></script>
  <script src="/script.js"></script>
  
  <!-- OpenCV.js (GitHub CDN via jsDelivr) -->
  <script async src="https://cdn.jsdelivr.net/gh/exclusiveLogin/rover-esp32@main/opencv.js" 
          crossorigin="anonymous"
          onload="window.dispatchEvent(new Event('opencv-ready'))"></script>
</body>
</html>
